{
    "$ref": "#/definitions/Set",

    "definitions": {
        "Set": {
            "switch": [
                {
                    "if": { "type": "object" },
                    "then": { "$ref": "#/definitions/Entity" }
                },
                {
                    "if": { "type": "array" },
                    "then": {
                        "minItems": 1,
                        "items": {
                            "switch": [
                                {
                                    "if": { "type": "object" },
                                    "then": { "$ref": "#/definitions/Entity" }
                                },
                                {
                                    "then": { "type": ["string", "object"] }
                                }
                            ]
                        }
                    }
                },
                {
                    "then": { "type": ["string", "object", "array"] }
                }
            ]
        },

        "Entity": {
            "type": "object",
            "minProperties": 1,
            "additionalProperties": false,
            "properties": {
                "block": { "type": "string" },
                "elem": { "$ref": "#/definitions/ElemPlainEntity" },
                "elems": {
                    "switch": [
                        {
                            "if": { "type": "object" },
                            "then": { "$ref": "#/definitions/ElemEntity" }
                        },
                        {
                            "if": { "type": "array" },
                            "then": {
                                "minItems": 1,
                                "items": {
                                    "switch": [
                                        {
                                            "if": { "type": "object" },
                                            "then": { "$ref": "#/definitions/ElemEntity" }
                                        },
                                        {
                                            "then": { "type": ["string", "object"] }
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "then": { "type": ["string", "object", "array"] }
                        }
                    ]
                },
                "mod": { "type": "string" },
                "val": {
                    "switch": [
                        {
                            "if": { "type": "boolean" },
                            "then": { "enum": [true] }
                        },
                        {
                            "then": { "type": ["string", "boolean"] }
                        }
                    ]
                },
                "mods": { "$ref": "#/definitions/Modifiers" },
                "tech": { "type": "string" },
                "include": { "enum": [false] },

                "noDeps": { "$ref": "#/definitions/Set" },
                "mustDeps": { "$ref": "#/definitions/Set" },
                "shouldDeps": { "$ref": "#/definitions/Set" }
            },
            "dependencies": {
                "elem": {
                    "not": { "required": ["elems"] }
                },
                "mod": {
                    "not": { "required": ["mods"] }
                },
                "val": {
                    "not": { "required": ["mods"] }
                }
            }
        },

        "ElemPlainEntity": {
            "switch": [
                {
                    "if": { "type": "array" },
                    "then": {
                        "minItems": 1,
                        "items": { "type": "string" }
                    }
                },
                {
                    "then": { "type": ["string", "array"] }
                }
            ]
        },

        "ElemEntity": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "elem": { "$ref": "#/definitions/ElemPlainEntity" },
                "mods": { "$ref": "#/definitions/Modifiers" },
                "tech": { "type": "string" },
                "include": { "enum": [false] },

                "noDeps": { "$ref": "#/definitions/Set" },
                "mustDeps": { "$ref": "#/definitions/Set" },
                "shouldDeps": { "$ref": "#/definitions/Set" }
            },
            "required": ["elem"]
        },

        "Modifiers": {
            "type": "object",
            "minProperties": 1,
            "additionalProperties": {
                "switch": [
                    {
                        "if": { "type": "boolean" },
                        "then": { "enum": [true] }
                    },
                    {
                        "if": { "type": "array" },
                        "then": {
                            "minItems": 1,
                            "items": { "type": "string" }
                        }
                    },
                    {
                        "then": { "type": ["boolean", "string", "array"] }
                    }
                ]
            }
        }
    }
}
